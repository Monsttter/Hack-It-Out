<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <title>Document</title>

    <style>
        .bd-placeholder-img {
          font-size: 1.125rem;
          text-anchor: middle;
          -webkit-user-select: none;
          -moz-user-select: none;
          user-select: none;
        }
  
        @media (min-width: 768px) {
          .bd-placeholder-img-lg {
            font-size: 3.5rem;
          }
        }
  
        .b-example-divider {
          height: 3rem;
          background-color: rgba(0, 0, 0, .1);
          border: solid rgba(0, 0, 0, .15);
          border-width: 1px 0;
          box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
        }
  
        .b-example-vr {
          flex-shrink: 0;
          width: 1.5rem;
          height: 100vh;
        }
  
        .bi {
          vertical-align: -.125em;
          fill: currentColor;
        }
  
        .nav-scroller {
          position: relative;
          z-index: 2;
          height: 2.75rem;
          overflow-y: hidden;
        }
  
        .nav-scroller .nav {
          display: flex;
          flex-wrap: nowrap;
          padding-bottom: 1rem;
          margin-top: -1px;
          overflow-x: auto;
          text-align: center;
          white-space: nowrap;
          -webkit-overflow-scrolling: touch;
        }
      </style>

</head>
<body>
    <header>
        <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
          <div class="container-fluid">
            <a class="navbar-brand" href="#">Title</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
              <ul class="navbar-nav me-auto mb-2 mb-md-0 navbar-right">
                <li class="nav-item">
                  <a class="nav-link" aria-current="page" href="/">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/about">About</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/resources">Resources</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/mentor">Mentors</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/login">Login</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/register">Register</a>
                </li>
              </ul>
              <!-- <form class="d-flex" role="search">
                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success" type="submit">Search</button>
              </form> -->
            </div>
          </div>
        </nav>
      </header>


      <div class="album py-5 bg-light my-4">
        <div class="container">
            
          <h1><%= courseField.fieldName %></h1>
          <div class="row row-cols-1 row-cols-sm-3 g-5">

            <% for(let i=0;i<courseField.courses.length;i++){ %>
                <div class="col">
                    <div class="card shadow-sm">
                      <svg class="bd-placeholder-img card-img-top" width="100%" height="225" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Placeholder: Thumbnail" preserveAspectRatio="xMidYMid slice" focusable="false"><title>Placeholder</title><rect width="100%" height="100%" fill="#55595c"/><text x="50%" y="50%" fill="#eceeef" dy=".3em">Thumbnail</text></svg>
                      <div class="card-body">
                        <div class="d-flex justify-content-between">
                        <p class="card-text"><%= courseField.courses[i].creator %></p>
                        <p ><%= courseField.courses[i].rating %></p>
                    </div>
                    <p class="text-end"><%= courseField.courses[i].ratedBy.length %> ratings</p>
                        <div class="d-flex justify-content-between align-items-center">
                          <div class="btn-group">
                              <a href="<%= courseField.courses[i].url %>"><button type="button" class="btn btn-sm btn-outline-secondary">View</button></a>
                          </div>
                        </div>
                        <% if(user){
                          console.log(courseField.courses[i].ratedBy);
                          if(courseField.courses[i].ratedBy.find(usr=> {
                            console.log(usr);
                            <!-- return 1; -->
                            return usr.substring(0,usr.length-1)===user.id;
                            })){ %>
                            <p>Your rating: <%= courseField.courses[i].ratedBy.find(usr => usr.substring(0,usr.length-1)===user.id).slice(-1) %></p>
                          <% } else{ %>
                            <p>Rate this course: 
                              <form action="/addRating" method="post">
                                <input type="number" name="rating" id="">
                                <input type="hidden" name="courseField" value="<%= courseField.id %>">
                                <input type="hidden" name="fieldName" value="<%= courseField.fieldName %>">
                                <input type="hidden" name="course" value="<%= courseField.courses[i].id %>">
                                <button type="submit" name="user" value="<%=user.id%>">Submit</button>
                              </form>
                            </p>
                          <% } %>
                        <% } else{ %>
                          <p>Sign In to give rating</p>
                        <% } %>
                      </div>
                    </div>
                  </div>
            <% } %>
            
          </div>
        </div>
      </div>


</body>
</html>